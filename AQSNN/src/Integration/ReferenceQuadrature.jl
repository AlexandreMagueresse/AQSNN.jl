struct ReferenceQuadrature{R,T,O,L}
  weights::Vector{T}
  points::Matrix{T}
end

eltype(::ReferenceQuadrature{R,T}) where {R,T} = T
getOrder(::ReferenceQuadrature{R,T,O}) where {R,T,O} = O
length(::ReferenceQuadrature{R,T,O,L}) where {R,T,O,L} = L

getWeights(rq::ReferenceQuadrature) = rq.weights
getPoints(rq::ReferenceQuadrature) = rq.points

################
# Constructors #
################
function ReferenceQuadrature(polytope::AbstractPolytope, order::Int)
  ReferenceQuadrature(typeof(polytope), order)
end

function ReferenceQuadrature(::Type{<:AbstractPolytope}, ::Int)
  @abstractmethod
end

o2n(n::Int) = div(n, 2) + 1

#########
# Point #
#########
function ReferenceQuadrature(::Type{<:Point{T}}, ::Int) where {T}
  ω = T[1]
  ξ = T[1;;]

  ReferenceQuadrature{Point,T,1,1}(ω, ξ)
end

###########
# Segment #
###########
function ReferenceQuadrature(::Type{<:Segment{T}}, order::Int) where {T}
  n = o2n(order)
  ξ, ω = gausslegendre(n)
  ω ./= 2
  ξ = ξ[:, 1:1]'

  ReferenceQuadrature{Segment,T,order,length(ω)}(ω, ξ)
end

############
# Triangle #
############
# High degree efficient symmetrical Gaussian quadrature rules for the triangle
# D. A. Dunavant
# https://doi.org/10.1002/nme.1620210612

# On the identification of symmetric quadrature rules for finite element methods
# F. D. Witherden, P. E. Vincent
# https://doi.org/10.1016/j.camwa.2015.03.017
# Their reference element is (-1, -1), (+1, -1), (-1, +1)
# But here it is (1, 0, 0), (0, 1, 0), (0, 0, 1)
# One mapping: (s, t) -> (-(s + t), s + 1, t + 1) / 2
# Rescale weights by 2
function ReferenceQuadrature(::Type{<:Triangle{T}}, order::Int) where {T}
  if order <= 20
    # Identity (center), order 1
    # w, (1/3, 1/3, 1/3)
    class0 = Vector{Tuple{String}}()
    # Rotation (on medians), order 3
    # s + 2t = 1
    # w, (s, t, t), (t, s, t), (t, t, s)
    class1 = Vector{Tuple{String,String,String}}()
    # Rotation and reflexion (both sides of medians), order 6
    # s + t + u = 1
    # w, (s, t, u), (t, u, s), (u, s, t)
    #    (s, u, t), (t, s, u), (u, t, s)
    class2 = Vector{Tuple{String,String,String,String}}()

    if order <= 1
      # 1
      push!(class0, ("1.00000000000000000000000000000000000000",))
    elseif order == 2
      # 3
      push!(class1, ("0.33333333333333333333333333333333333333", "0.66666666666666666666666666666666666666", "0.16666666666666666666666666666666666666"))
    elseif order == 3
      # 4
      # push!(class0, ("-0.56250000000000000000000000000000000000",))
      # push!(class1, ("0.520833333333333333333333333333333333333", "0.6000000000000000000000000000000000000", "0.20000000000000000000000000000000000000"))

      # 6
      push!(class1, ("0.10995174365532186763832632490021052896", "0.81684757298045851308085707319559698429", "0.09157621350977074345957146340220150785"))
      push!(class1, ("0.22338158967801146569500700843312280436", "0.10810301816807022736334149223389602320", "0.44594849091596488631832925388305198840"))
    elseif order == 4
      # 6
      # push!(class1, ("0.109951743655322", "0.816847572980459", "0.091576213509771"))
      # push!(class1, ("0.223381589678011", "0.108103018168070", "0.445948490915965"))

      # 6
      push!(class1, ("0.10995174365532186763832632490021052896", "0.81684757298045851308085707319559698429", "0.09157621350977074345957146340220150785"))
      push!(class1, ("0.22338158967801146569500700843312280436", "0.10810301816807022736334149223389602320", "0.44594849091596488631832925388305198840"))
    elseif order == 5
      # 7
      # push!(class0, ("0.225000000000000",))
      # push!(class1, ("0.125939180544827", "0.797426985353087", "0.101286507323456"))
      # push!(class1, ("0.132394152788506", "0.059715871789770", "0.470142064105115"))

      # 7
      push!(class0, ("0.22500000000000000000000000000000000000",))
      push!(class1, ("0.12593918054482715259568394550018133365", "0.79742698535308732239802527616975234389", "0.10128650732345633880098736191512382805"))
      push!(class1, ("0.13239415278850618073764938783315199967", "0.05971587178976982045911758097310479896", "0.47014206410511508977044120951344760051"))
    elseif order == 6
      # 12
      # push!(class1, ("0.050844906370207", "0.873821971016996", "0.063089014491502"))
      # push!(class1, ("0.116786275726379", "0.501426509658179", "0.249286745170910"))
      # push!(class2, ("0.082851075618374", "0.053145049844817", "0.310352451033784", "0.636502499121399"))

      # 12
      push!(class1, ("0.05084490637020681692093680910686898404", "0.87382197101699554331933679425836168532", "0.06308901449150222834033160287081915734"))
      push!(class1, ("0.11678627572637936602528961138557944132", "0.50142650965817915741672289378596184782", "0.24928674517091042129163855310701907608"))
      push!(class2, ("0.08285107561837357519355345642044245398", "0.05314504984481694735324967163139814699", "0.31035245103378440541660773395655215320", "0.63650249912139864723014259441204969980"))
    elseif order == 7
      # 13
      # push!(class0, ("-0.149570044467682",))
      # push!(class1, ("0.053347235608838", "0.869739794195568", "0.065130102902216"))
      # push!(class1, ("0.175615257433208", "0.479308067841920", "0.260345966079040"))
      # push!(class2, ("0.077113760890257", "0.048690315425316", "0.312865496004874", "0.638444188569810"))

      # 15
      push!(class1, ("0.01654505011079213103597794847291744561", "0.93253870289082430257005654739836752384", "0.03373064855458784871497172630081623807"))
      push!(class1, ("0.07708664618598606783482152083374138646", "0.05138061499056353158083852810162843503", "0.47430969250471823420958073594918578248"))
      push!(class1, ("0.12794417123015557278290123518464631066", "0.51684523480919288209962646032443600082", "0.24157738259540355895018676983778199959"))
      push!(class2, ("0.05587873290319978083981631442101409529", "0.04703664465259523334140997535688497551", "0.19868331479735158930235070001499506078", "0.75428004055005317735623932462811996369"))
    elseif order == 8
      # 16
      # push!(class0, ("0.144315607677787",))
      # push!(class1, ("0.032458497623198", "0.898905543365938", "0.050547228317031"))
      # push!(class1, ("0.095091634267285", "0.081414823414554", "0.459292588292723"))
      # push!(class1, ("0.103217370534718", "0.658861384496480", "0.170569307751760"))
      # push!(class2, ("0.027230314174435", "0.008394777409958", "0.263112829634638", "0.728492392955404"))

      # 16
      push!(class0, ("0.14431560767778716825109111048906462479",))
      push!(class1, ("0.03245849762319808031092592834178059679", "0.89890554336593804908315289880680210630", "0.05054722831703097545842355059659894684"))
      push!(class1, ("0.09509163426728462479389610438858431660", "0.08141482341455368794236897101166135587", "0.45929258829272315602881551449416932206"))
      push!(class1, ("0.10321737053471825028179155029212903001", "0.65886138449647958675541299701707099795", "0.17056930775176020662229350149146450102"))
      push!(class2, ("0.02723031417443499426484469007390892415", "0.00839477740995760533721383453929444918", "0.26311282963463811342178578628464358779", "0.72849239295540428124100037917606196302"))
    elseif order == 9
      # 19
      # push!(class0, ("0.097135796282799",))
      # push!(class1, ("0.025577675658698", "0.910540973211095", "0.044729513394453"))
      # push!(class1, ("0.031334700227139", "0.020634961602525", "0.489682519198738"))
      # push!(class1, ("0.077827541004774", "0.125820817014127", "0.437089591492937"))
      # push!(class1, ("0.079647738927210", "0.188203535619033", "0.623592928761935"))
      # push!(class2, ("0.043283539377289", "0.036838412054736", "0.221962989160766", "0.741198598784498"))

      # 19
      push!(class0, ("0.09713579628279883381924198250728862974",))
      push!(class1, ("0.02557767565869803126167879855899982397", "0.91054097321109458026978682006744727000", "0.04472951339445270986510658996627636499"))
      push!(class1, ("0.03133470022713907053685483128720931549", "0.02063496160252474443258615032761440126", "0.48968251919873762778370692483619279936"))
      push!(class1, ("0.07782754100477427931673935629940395612", "0.12582081701412672546013927112929005463", "0.43708959149293663726993036443535497268"))
      push!(class1, ("0.07964773892721025303289177426404527324", "0.62359292876193453951807743906532886377", "0.18820353561903273024096128046733556811"))
      push!(class2, ("0.04328353937728937728937728937728937728", "0.03683841205473628363481759878338510231", "0.22196298916076569567510252769319107025", "0.74119859878449802069007987352342382743"))
    elseif order == 10
      # 25
      # push!(class0, ("0.090817990382754",))
      # push!(class1, ("0.036725957756467", "0.028844733232685", "0.485577633383657"))
      # push!(class1, ("0.045321059435528", "0.781036849029926", "0.109481575485037"))
      # push!(class2, ("0.009421666963733", "0.009540815400299", "0.066803251012200", "0.923655933587500"))
      # push!(class2, ("0.028327242531057", "0.025003534762686", "0.246672560639903", "0.728323904597411"))
      # push!(class2, ("0.072757916845420", "0.141707219414880", "0.307939838764121", "0.550352941820999"))

      # 25
      push!(class0, ("0.08174332914628596642811868498417761219",))
      push!(class1, ("0.01335296881314956627557297839906865349", "0.93588925356611297413803082132702052206", "0.03205537321694351293098458933648973896"))
      push!(class1, ("0.04595796360474472801378790963254781640", "0.71567779788687122981567579361808335655", "0.14216110105656438509216210319095832172"))
      push!(class2, ("0.02529775770728838438904279068283321756", "0.02836766533993843925043575557813020559", "0.16370173373718249566961434154012568534", "0.80793060092287906507994990288174410906"))
      push!(class2, ("0.03418464816295942862869158404134229025", "0.02961988948872976763383626942604280052", "0.36914678182781098691142083711526939010", "0.60123332868345924545474289345868780937"))
      push!(class2, ("0.06390490639642404543289873376265332186", "0.14813288578382055049780676506825716937", "0.32181299528883542122509756098604871373", "0.53005411892734402827709567394569411688"))
    elseif order == 11
      # 27
      # push!(class1, ("0.000927006328961", "-0.069222096541517", "0.534611048270758"))
      # push!(class1, ("0.013659731002678", "0.935270103777448", "0.032364948111276"))
      # push!(class1, ("0.036184540503418", "0.761298175434837", "0.119350912282581"))
      # push!(class1, ("0.059322977380774", "0.593380199137435", "0.203309900431282"))
      # push!(class1, ("0.077149534914813", "0.202061394068290", "0.398969302965855"))
      # push!(class2, ("0.020707659639141", "0.021022016536166", "0.171488980304042", "0.807489003159792"))
      # push!(class2, ("0.052337111962204", "0.050178138310495", "0.356620648261293", "0.593201213428213"))

      # 28
      push!(class0, ("0.08576117973222421713819912536532699447",))
      push!(class1, ("0.01043187051289469587302849209866231685", "0.94302916477125618104036726638981901865", "0.02848541761437190947981636680509049067"))
      push!(class1, ("0.01660627305458536957637583927505606086", "0.00821619806821817387011976199276801472", "0.49589190096589091306494011900361599263"))
      push!(class1, ("0.03863075923701932247663380458940114914", "0.79472903457550713910176986023011167594", "0.10263548271224643044911506988494416202"))
      push!(class1, ("0.06731615407946830119783720562328778588", "0.12306814647129561795332827431496109166", "0.43846592676435219102333586284251945416"))
      push!(class1, ("0.07051568411171657834207385917292836981", "0.57956008659364348598387546330841477973", "0.21021995670317825700806226834579261013"))
      push!(class2, ("0.01029028957295327749308062748397952971", "0.00732542768606445160528277572400154683", "0.14932478865208238619572578787717352262", "0.84334978366185316219899143639882493053"))
      push!(class2, ("0.04033247664050055258424491790879812992", "0.04601050016542995588995977629486725512", "0.28958112563770584670649254737261695872", "0.66440837419686419740354767633251578614"))
    elseif order == 12
      # 33
      # push!(class1, ("0.006166261051559", "0.957365299093579", "0.021317350453210"))
      # push!(class1, ("0.025731066440455", "0.023565220452390", "0.488217389773805"))
      # push!(class1, ("0.034796112930709", "0.744847708916828", "0.127576145541586"))
      # push!(class1, ("0.043692544538038", "0.120551215411079", "0.439724392294460"))
      # push!(class1, ("0.062858224217885", "0.457579229975768", "0.271210385012116"))
      # push!(class2, ("0.017316231108659", "0.025734050548330", "0.116251915907597", "0.858014033544073"))
      # push!(class2, ("0.022356773202303", "0.022838332222257", "0.281325580989940", "0.695836086787803"))
      # push!(class2, ("0.040371557766381", "0.115343494534698", "0.275713269685514", "0.608943235779788"))

      # 33
      push!(class1, ("0.00793164250997363845931478790585973448", "0.95070727312732881046653760557133084360", "0.02464636343633559476673119721433457819"))
      push!(class1, ("0.02426683808145203315071797257560808389", "0.02359249810891689644398375226237048615", "0.48820375094554155177800812386881475692"))
      push!(class1, ("0.02848605206887754499969447390751544625", "0.78148434468129141883250537599138250938", "0.10925782765935429058374731200430874530"))
      push!(class1, ("0.04991833492806094211905172206099430095", "0.11977670268281377797309259385418361789", "0.44011164865859311101345370307290819105"))
      push!(class1, ("0.06254121319590276046932378144551983912", "0.45707498597014783024400810395490980293", "0.27146250701492608487799594802254509853"))
      push!(class2, ("0.01508367757651143858585059046276691280", "0.02138249025617058959415451482055921246", "0.12727971723358936878784187474738233893", "0.85133779251024004161800361043205844859"))
      push!(class2, ("0.02178358503860755793263143633929182186", "0.02303415635526713948164150192892913211", "0.29165567973834096053391381193394061718", "0.68531016390639189998444468613713025069"))
      push!(class2, ("0.04322736365941421054913327091685922963", "0.11629601967792658663074813414970113889", "0.25545422863851734653135572748306966273", "0.62824975168355606683789613836722919837"))
    elseif order == 13
      # 37
      # push!(class0, ("0.052520923400802",))
      # push!(class1, ("0.007975771465074", "0.950377217273082", "0.024811391363459"))
      # push!(class1, ("0.011280145209330", "0.009903630120591", "0.495048184939705"))
      # push!(class1, ("0.031167529045794", "0.771151009607340", "0.114424495196330"))
      # push!(class1, ("0.031423518362454", "0.062566729780852", "0.468716635109574"))
      # push!(class1, ("0.047072502504194", "0.170957326397447", "0.414521336801277"))
      # push!(class1, ("0.047363586536355", "0.541200855914337", "0.229399572042831"))
      # push!(class2, ("0.015521786839045", "0.022233076674090", "0.126357385491669", "0.851409537834241"))
      # push!(class2, ("0.017401463303822", "0.018100773278807", "0.291730066734288", "0.690169159986905"))
      # push!(class2, ("0.036848402728732", "0.094853828379579", "0.268794997058761", "0.636351174561660"))

      # 37
      push!(class0, ("0.06796003658683164428177442468088487951",))
      push!(class1, ("0.00605233710353917184179280003229082446", "0.95698063778231363226141737293189583479", "0.02150968110884318386929131353405208260"))
      push!(class1, ("0.02399440192889473077371079945095965372", "0.02184610709492130019862056181959122468", "0.48907694645253934990068971909020438765"))
      push!(class1, ("0.05560196753045332870725746601046146753", "0.14611717148039918795837492993725157719", "0.42694141425980040602081253503137421140"))
      push!(class1, ("0.05827848511919998140476708351333980951", "0.55725542741633419869037489058984184447", "0.22137228629183290065481255470507907776"))
      push!(class2, ("0.00959068100354326272259509016611089138", "0.00512638910238236855932940334112910597", "0.27251581777342966618005046435408684539", "0.72235779312418796526062013230478404862"))
      push!(class2, ("0.01496540110516566726324585713290343800", "0.02437018690109382928458450388263229488", "0.11092204280346339541286954522167452177", "0.86470777029544277530254595089569318333"))
      push!(class2, ("0.02417903981159381913744574557306075929", "0.08789548303219732459309350250033310111", "0.16359740106785048023388790171095724884", "0.74850711589995219517301859578870965004"))
      push!(class2, ("0.03464127614084837046598682851091822044", "0.06801224355420665452567379427251810445", "0.30844176089211777465847185254124530972", "0.62354599555367557081585435318623658582"))
    elseif order == 14
      # 42
      # push!(class1, ("0.004923403602400", "0.961218077502598", "0.019390961248701"))
      # push!(class1, ("0.014433699669777", "0.876400233818255", "0.061799883090873"))
      # push!(class1, ("0.021883581369429", "0.022072179275643", "0.488963910362179"))
      # push!(class1, ("0.032788353544125", "0.164710561319092", "0.417644719340454"))
      # push!(class1, ("0.042162588736993", "0.645588935174913", "0.177205532412543"))
      # push!(class1, ("0.051774104507292", "0.453044943382323", "0.273477528308839"))
      # push!(class2, ("0.005010228838501", "0.001268330932872", "0.118974497696957", "0.879757171370171"))
      # push!(class2, ("0.014436308113534", "0.014646950055654", "0.298372882136258", "0.686980167808088"))
      # push!(class2, ("0.024665753212564", "0.057124757403648", "0.172266687821356", "0.770608554774996"))
      # push!(class2, ("0.038571510787061", "0.092916249356972", "0.336861459796345", "0.570222290846683"))

      # 42
      push!(class1, ("0.00492340360240008168182602350904215476", "0.96121807750259790364349980989094097785", "0.01939096124870104817825009505452951107"))
      push!(class1, ("0.01443369966977666760170992148065331661", "0.87640023381825479746504234312612842323", "0.06179988309087260126747882843693578838"))
      push!(class1, ("0.02188358136942889064084494596332597153", "0.02207217927564272264524795909521952841", "0.48896391036217863867737602045239023579"))
      push!(class1, ("0.03278835354412535064131097873862534323", "0.16471056131909215498111835562871312178", "0.41764471934045392250944082218564343910"))
      push!(class1, ("0.04216258873699301753823043732418612984", "0.64558893517491312608677861906988184783", "0.17720553241254343695661069046505907608"))
      push!(class1, ("0.05177410450729158631478491016639640241", "0.45304494338232268049011143347460288760", "0.27347752830883865975494428326269855619"))
      push!(class2, ("0.00501022883850067176986009308248911646", "0.00126833093287202508724640109549269267", "0.11897449769695684539818196192990548132", "0.87975717137017112951457163697460182600"))
      push!(class2, ("0.01443630811353384049608869199901580344", "0.01464695005565440967054132792007421165", "0.29837288213625775297083151805961272859", "0.68698016780808783735862715402031305975"))
      push!(class2, ("0.02466575321256367396287524518363622831", "0.05712475740364793903567712421891471031", "0.17226668782135557837528960161365733335", "0.77060855477499648258903327416742795633"))
      push!(class2, ("0.03857151078706068322848902781041085923", "0.09291624935697182475824858954872035130", "0.33686145979634500174405519708892538905", "0.57022229084668317349769621336235425963"))
    elseif order == 15
      # 48
      # push!(class1, ("0.001916875642849", "-0.013945833716486", "0.506972916858243"))
      # push!(class1, ("0.004748916608192", "0.962069659517853", "0.018965170241073"))
      # push!(class1, ("0.013289775690021", "0.858383228050628", "0.070808385974686"))
      # push!(class1, ("0.023687735870688", "0.747070217917492", "0.126464891041254"))
      # push!(class1, ("0.044249027271145", "0.137187291433955", "0.431406354283023"))
      # push!(class1, ("0.051186548718852", "0.444612710305711", "0.277693644847144"))
      # push!(class2, ("0.002182077366797", "-0.010174883126571", "0.285712220049916", "0.724462663076655"))
      # push!(class2, ("0.007673942631049", "0.012459809331199", "0.103575616576386", "0.883964574092416"))
      # push!(class2, ("0.021505319847731", "0.036843869875878", "0.215599664072284", "0.747556466051838"))
      # push!(class2, ("0.027215814320624", "0.036366677396917", "0.388046767090269", "0.575586555512814"))
      # push!(class2, ("0.038550072599593", "0.133734161966621", "0.261311371140087", "0.604954466893291"))

      # 49
      push!(class0, ("0.04433538738218407538759934065703240397",))
      push!(class1, ("0.00296077463790537556927630263836493938", "0.96837654749802270888209653243226493969", "0.01581172625098864555895173378386753015"))
      push!(class1, ("0.00957384618246008620656925362659355870", "0.01000608646174763152440070463217828210", "0.49499695676912618423779964768391085894"))
      push!(class1, ("0.01644473756262516376868000868850912945", "0.85965289420002796503128049571314279072", "0.07017355289998601748435975214342860463"))
      push!(class1, ("0.01739614800076341455772655088425475332", "0.05165863712396041604261860945178818825", "0.47417068143801979197869069527410590587"))
      push!(class1, ("0.04271378157146056704136291937283418034", "0.18927557173204904426648777856049828207", "0.40536221413397547786675611071975085896"))
      push!(class1, ("0.04678336172870963235626889478077423918", "0.54724257315930080341854883783076139454", "0.22637871342034959829072558108461930272"))
      push!(class2, ("0.00402985337201809961836433491085650782", "0.00913923703730839503655181749098651809", "0.07094860523645554006058758721222110794", "0.91991215772623606490286059529679237396"))
      push!(class2, ("0.01167262118157584533957700554433658592", "0.01863871372816637462296409840301257078", "0.16806864522241435546477758858362946060", "0.81329264104941926991225831301335796861"))
      push!(class2, ("0.01560257283057596475177491582850042315", "0.01837611238568109196104439558139591830", "0.31464824281245081809263206521489198162", "0.66697564480186808994632353920371210006"))
      push!(class2, ("0.02872058692520134023066564167165085600", "0.09424205359215536468533038153030541818", "0.19053558947639393343069024968596414015", "0.71522235693145070188397936878373044166"))
      push!(class2, ("0.03131547628496928441174291360615149288", "0.09579672364760859633355506096279173040", "0.33895061147527718921459300467045198206", "0.56525266487711421445185193436675628753"))
    elseif order == 16
      # 52
      # push!(class0, ("0.046875697427642",))
      # push!(class1, ("0.003582462351273", "0.966807194753950", "0.016596402623025"))
      # push!(class1, ("0.006405878578585", "0.005238916103123", "0.497380541948438"))
      # push!(class1, ("0.014200098925024", "0.849069624685052", "0.075465187657474"))
      # push!(class1, ("0.026891484250064", "0.059082801866017", "0.470458599066991"))
      # push!(class1, ("0.030000266842773", "0.704068411554854", "0.147965794222573"))
      # push!(class1, ("0.041710296739387", "0.173061122901295", "0.413469438549352"))
      # push!(class1, ("0.042132522761650", "0.518892500060958", "0.240553749969521"))
      # push!(class2, ("0.002386244192839", "-0.004341002614139", "0.204748281642812", "0.799592720971327"))
      # push!(class2, ("0.006850054546542", "0.014317320230681", "0.085283615682657", "0.900399064086661"))
      # push!(class2, ("0.015298306248441", "0.020083411655416", "0.337723063403079", "0.642193524941505"))
      # push!(class2, ("0.019084792755899", "0.041941786468010", "0.189358492130623", "0.768699721401368"))
      # push!(class2, ("0.032773147460627", "0.103575692245252", "0.296555596579887", "0.599868711174861"))

      # 55
      push!(class0, ("0.04526456607381879289934140237574895293",))
      push!(class1, ("0.04109292314369894954142991887192317492", "0.50801985906571653105656444046583964100", "0.24599007046714173447171777976708017949"))
      push!(class1, ("0.04071183331242535925236380230494611571", "0.16883020622915897355803864763197452860", "0.41558489688542051322098067618401273569"))
      push!(class1, ("0.01478163469022440398018218760321936337", "0.82928886682659935648935022895726939779", "0.08535556658670032175532488552136530110"))
      push!(class1, ("0.02941840969898809786061135222278270575", "0.67616271161745754624623346597531512883", "0.16191864419127122687688326701234243558"))
      push!(class1, ("0.00441854631215056892538423178915460908", "0.00000000000000000000000000000000000000", "0.50000000000000000000000000000000000000"))
      push!(class1, ("0.02597433329827715832030229184703344048", "0.04943854490811579182348441893097608994", "0.47528072754594210408825779053451195502"))
      push!(class2, ("0.01893827246441569896954621380670940901", "0.05475517491470311289172371139658370514", "0.19107476364052907925328725197427101983", "0.75417006144476780785498903662914527501"))
      push!(class2, ("0.00165446671483504819239581394810221541", "0.00855220420022761177791386452027361739", "0.02320342776881370903748854127160039318", "0.96824436803095867918459759420812598942"))
      push!(class2, ("0.01500860178428580608256848226085747497", "0.01893177828040591498171527052738816285", "0.33176452347414767688865823369070385240", "0.64930369824544640812962649578190798474"))
      push!(class2, ("0.00794759393339249881059959810905404675", "0.01903012974369744879093521215748173968", "0.08069616698587292507205787064864643269", "0.90027370327042962613700691719387182762"))
      push!(class2, ("0.03198361007937006878481406164393311474", "0.10260619023939809630172485161457177296", "0.30824496919635398490798844775700040539", "0.58914884056424791879028670062842782163"))
      push!(class2, ("0.00539118711684881140338203751585587560", "0.00593635001682226990748196761065801599", "0.18744178248378208764108770608227729520", "0.80662186749939564245143032630706468878"))
    elseif order == 17
      # 61
      # push!(class0, ("0.033437199290803",))
      # push!(class1, ("0.003194676173779", "0.968690546064356", "0.015654726967822"))
      # push!(class1, ("0.005093415440507", "0.005658918886452", "0.497170540556774"))
      # push!(class1, ("0.014056073070557", "0.848248235478508", "0.075875882260746"))
      # push!(class1, ("0.014670864527638", "0.035647354750751", "0.482176322624625"))
      # push!(class1, ("0.024350878353672", "0.099520061958437", "0.450239969020782"))
      # push!(class1, ("0.024815654339665", "0.675905990683077", "0.162047004658461"))
      # push!(class1, ("0.031107550868969", "0.199467521245206", "0.400266239377397"))
      # push!(class1, ("0.031257111218620", "0.495717464058095", "0.252141267970953"))
      # push!(class2, ("0.006665632004165", "0.014663182224828", "0.080711313679564", "0.904625504095608"))
      # push!(class2, ("0.008119655318993", "0.010186928826919", "0.334319867363658", "0.655493203809423"))
      # push!(class2, ("0.008476868534328", "0.012868560833637", "0.190704224192292", "0.796427214974071"))
      # push!(class2, ("0.018292796770025", "0.067165782413524", "0.180483211648746", "0.752351005937729"))
      # push!(class2, ("0.018459993210822", "0.054423924290583", "0.319574885423190", "0.626001190286228"))
      # push!(class2, ("0.026805742283163", "0.135440871671036", "0.292221537796944", "0.572337590532020"))

      # 60
      push!(class1, ("0.00277388757763764215461249259232964495", "0.97048901667849209319369164139840939816", "0.01475549166075395340315417930079530091"))
      push!(class1, ("0.01245900080230544209525004286541368351", "0.86669187304080614048646650320300230600", "0.06665406347959692975676674839849884699"))
      push!(class1, ("0.02501945095049735779705753017638272726", "0.06880425676221939620821681830612454251", "0.46559787161889030189589159084693772874"))
      push!(class1, ("0.02631263058801798495603441517357965272", "0.63928376746725875962831385554123912212", "0.18035811626637062018584307222938043893"))
      push!(class1, ("0.02731092652810210752377884755402974234", "0.16579311127680159678975416725600076679", "0.41710344436159920160512291637199961660"))
      push!(class1, ("0.03771623715279528001642880596795522975", "0.42858699512682674399632424251061595820", "0.28570650243658662800183787874469202089"))
      push!(class2, ("0.00458434840173586684294960737077960080", "0.01157517590318061534804211840161445889", "0.07250547079900242627452564245924220147", "0.91591935329781695837743223913914333961"))
      push!(class2, ("0.00797830020592959332428262214506552490", "0.01601764236211929684240731213326478653", "0.15919228747279267872330207968591509060", "0.82479007016508802443429060818082012285"))
      push!(class2, ("0.00869221450100119156877392544049573664", "0.01313587083400269496660363942996967265", "0.27179187005535484351747174019366730535", "0.71507225911064246151592462037636302199"))
      push!(class2, ("0.01039843995583953646362856537808827398", "0.01322967276008689330701671334910558696", "0.41547545929522905484233417495493581561", "0.57129486794468405185064911169595859742"))
      push!(class2, ("0.02055789832045451749600582958142192413", "0.07804234056828242417133087051931311510", "0.16872251349525945693224173036632698554", "0.75323514593645811889642739911435989934"))
      push!(class2, ("0.02248777254669106644232215578016900297", "0.06734937786736119639596820334731430224", "0.30628159174618654153530949385487337257", "0.62636903038645226206872230279781232518"))
      push!(class2, ("0.02617162593533698725712289380580126292", "0.15750547792686990502761091552370071432", "0.29921894247697032086774068478605695189", "0.54327557959615977410464839969024233378"))
    elseif order == 18
      # 70
      # push!(class0, ("0.030809939937647",))
      # push!(class1, ("-0.002223098729920", "0.913707265566071", "0.043146367216965"))
      # push!(class1, ("0.006793922022963", "0.951495121293100", "0.024252439353450"))
      # push!(class1, ("0.009072436679404", "0.013310382738157", "0.493344808630921"))
      # push!(class1, ("0.015271927971832", "0.846803545029257", "0.076598227485371"))
      # push!(class1, ("0.018761316939594", "0.061578811516086", "0.469210594241957"))
      # push!(class1, ("0.019441097985477", "0.127437208225989", "0.436281395887006"))
      # push!(class1, ("0.027753948610810", "0.210307658653168", "0.394846170673416"))
      # push!(class1, ("0.025074032616922", "0.677135612512315", "0.161432193743843"))
      # push!(class1, ("0.032256225351457", "0.500410862393686", "0.249794568803157"))
      # push!(class2, ("0.000046187660794", "-0.035222015287949", "0.020874755282586", "1.014347260005363"))
      # push!(class2, ("0.006331914076406", "0.008430536202420", "0.358911494940944", "0.632657968856636"))
      # push!(class2, ("0.007634129070725", "0.014858100590125", "0.101179597136408", "0.883962302273467"))
      # push!(class2, ("0.008104732808192", "0.011996194566236", "0.218796800013321", "0.769207005420443"))
      # push!(class2, ("0.017676785649465", "0.050203151565675", "0.325017801641814", "0.624779046792512"))
      # push!(class2, ("0.018379484638070", "0.066329263810916", "0.184737559666046", "0.748933176523037"))
      # push!(class2, ("0.027257538049138", "0.131186551737188", "0.294402476751957", "0.574410971510855"))

      # 67
      push!(class0, ("0.03635573530142666616799420148807566020",))
      push!(class1, ("0.00712932601971897067776415480546949553", "0.92233948782262881057955835940173820881", "0.03883025608868559471022082029913089559"))
      push!(class1, ("0.01204664763399971011842679065340193468", "0.02483939685026087537362893459979354465", "0.48758030157486956231318553270010322767"))
      push!(class1, ("0.01655915995200324916805805598963090969", "0.81610451575671360652823121099663693088", "0.09194774212164319673588439450168153455"))
      push!(class1, ("0.01894917150677886602609236225179138040", "0.07638098718710153726257412441632586424", "0.46180950640644923136871293779183706787"))
      push!(class1, ("0.03330447003339013528541551025662493871", "0.20008874386484753663926775646038722346", "0.39995562806757623168036612176980638826"))
      push!(class1, ("0.03647508940894363703414464795864734521", "0.51547059497145607559012153340572104877", "0.24226470251427196220493923329713947561"))
      push!(class2, ("0.00122294812696108977921802409749787118", "0.00054836004204231899241800977468699332", "0.02709091099516201422578336016714023890", "0.97236072896279566678179863005817276776"))
      push!(class2, ("0.00453053450225706539920455447956477920", "0.00389761103347338253692169134281066202", "0.39568343433226970269721534053678839066", "0.60041895463425691476586296812040094731"))
      push!(class2, ("0.00501066087457972170387063569694102647", "0.00529833518660976530078710089623529360", "0.23577218495819174065406344526940344668", "0.75892947985519849404514945383436125971"))
      push!(class2, ("0.00684011011960718149022775803832478761", "0.01346201674144498921436010509628825028", "0.10819579379103329302978954322588342576", "0.87834218946752171775585035167782832395"))
      push!(class2, ("0.01375961623494220523791952320918488669", "0.04580491585986078112859209250595773954", "0.18382270792546400564209794998820013771", "0.77037237621467521322930995750584212273"))
      push!(class2, ("0.01774748910202040511639496223084548367", "0.04026028346990806314438360240254574392", "0.31975162452537734194457010425926447991", "0.63998809200471459491104629333818977616"))
      push!(class2, ("0.02378191090015282995159169711158797728", "0.12269675737192755341949911705742148109", "0.20634925743383793341934518517557742511", "0.67095398519423451316115569776700109380"))
      push!(class2, ("0.02548217531182443947195638393025757570", "0.12058769516392464317678505321064375292", "0.33349352944988075701452092571342908067", "0.54591877538619459980869402107592716639"))
    elseif order == 19
      # 73
      # push!(class0, ("0.032906331388919",))
      # push!(class1, ("0.002079362027485", "0.974756272445543", "0.012621863777229"))
      # push!(class1, ("0.008084580261784", "0.888942751496321", "0.055528624251840"))
      # push!(class1, ("0.010330731891272", "0.020780025853987", "0.489609987073006"))
      # push!(class1, ("0.016050803586801", "0.779877893544096", "0.110061053227952"))
      # push!(class1, ("0.022387247263016", "0.090926214604215", "0.454536892697893"))
      # push!(class1, ("0.024159212741641", "0.645844115695741", "0.177077942152130"))
      # push!(class1, ("0.030266125869468", "0.197166638701138", "0.401416680649431"))
      # push!(class1, ("0.030490967802198", "0.488896691193805", "0.255551654403098"))
      # push!(class2, ("0.002491941817491", "0.002861120350567", "0.157807405968595", "0.839331473680839"))
      # push!(class2, ("0.003799928855302", "0.010161119296278", "0.065494628082938", "0.924344252620784"))
      # push!(class2, ("0.003884876904981", "0.003611417848412", "0.395754787356943", "0.600633794794645"))
      # push!(class2, ("0.008880903573338", "0.014446025776115", "0.264566948406520", "0.720987025817365"))
      # push!(class2, ("0.010258563736199", "0.034647074816760", "0.142421601113383", "0.822931324069857"))
      # push!(class2, ("0.016124546761731", "0.046933578838178", "0.358539352205951", "0.594527068955871"))
      # push!(class2, ("0.018242840118951", "0.223861424097916", "0.075050596975911", "0.701087978926173"))
      # push!(class2, ("0.025574160612022", "0.134466754530780", "0.307929983880436", "0.557603261588784"))

      # 73
      push!(class0, ("0.03446939770401233490601320845685707501",))
      push!(class1, ("0.00710925659779813053771909747219061125", "0.89495221929758206597048698795512662292", "0.05252389035120896701475650602243668853"))
      push!(class1, ("0.01032175514294428168968763575564984788", "0.01497464991732626100620467282075052436", "0.49251267504133686949689766358962473781"))
      push!(class1, ("0.01523435109301829958121580898530768225", "0.77710225335395724709458940859057135023", "0.11144887332302137645270529570471432488"))
      push!(class1, ("0.02298359002674160623031016877279702006", "0.08161159792091268505961214209837404408", "0.45919420103954365747019392895081297796"))
      push!(class1, ("0.03153753489315497507652519488164361492", "0.19206055489619760678392498292764093083", "0.40396972255190119660803750853617953458"))
      push!(class1, ("0.02465191484819085329051358016404366578", "0.64365979043647137831445631799854042799", "0.17817010478176431084277184100072978600"))
      push!(class1, ("0.00176532277644284765972425889494741818", "0.97672107763242110615802660011074523648", "0.01163946118378944692098669994462738175"))
      push!(class1, ("0.03175301936600307697094872249967036253", "0.48967673417278460498250110195791340279", "0.25516163291360769750874944902104329860"))
      push!(class2, ("0.00969548448685504579892973322856694129", "0.03914585933169222132467187110289101290", "0.13069767626803240456960894234712763239", "0.83015646440027537410571918654998135469"))
      push!(class2, ("0.02634632197739073318518149884503229818", "0.12931256447015783306601555185650146191", "0.31131762980954125277513064978698455387", "0.55936980572030091415885379835651398420"))
      push!(class2, ("0.00328207655183581925594534173116642999", "0.00206892589660480761010570185940547896", "0.36461778097461105934302663914959395190", "0.63331329312878413304686765899100056912"))
      push!(class2, ("0.01810794493121245006465256369856669962", "0.07456029460162667853706512541265178407", "0.22143488543233121158205568380568898905", "0.70400481996604210988087919078165922687"))
      push!(class2, ("0.00292631510347020040614682884905698719", "0.00500728825735449113349109438258288932", "0.14242575736575630918825559044341217991", "0.85256695437688919967825331517400493076"))
      push!(class2, ("0.01610216276402410820999201348264379110", "0.04088801119601687613912789552879461629", "0.35402800973527515974802268528227292630", "0.60508397906870796411284941918893245739"))
      push!(class2, ("0.00845588749953649681752107045359094355", "0.01492405208198407167540038607536061135", "0.24189457896057956857802899719314138232", "0.74318136895743635974657061673149800631"))
      push!(class2, ("0.00332720136285938825897318125544128508", "0.00977602580088815535131572896412301898", "0.06008627532230669799239624595785793086", "0.93013769887680514665628802507801905014"))
    elseif order == 20
      # 79
      # push!(class0, ("0.033057055541624",))
      # push!(class1, ("-0.000632060497488", "0.916762569607942", "0.041618715196029"))
      # push!(class1, ("0.000867019185663", "-0.001900928704400", "0.500950464352200"))
      # push!(class1, ("0.001751134301193", "0.976836157186356", "0.011581921406822"))
      # push!(class1, ("0.007698301815602", "0.893862072318140", "0.053068963840930"))
      # push!(class1, ("0.011660052716448", "0.023574084130543", "0.488212957934729"))
      # push!(class1, ("0.015997432032024", "0.791658289326483", "0.104170855336758"))
      # push!(class1, ("0.022876936356421", "0.089726636099435", "0.455136681950283"))
      # push!(class1, ("0.024368057676800", "0.647023488009788", "0.176488255995106"))
      # push!(class1, ("0.030448982673938", "0.196007481363421", "0.401996259318289"))
      # push!(class1, ("0.030624891725355", "0.488214180481157", "0.255892909759421"))
      # push!(class2, ("0.000704404677908", "-0.008368153208227", "0.146965436053239", "0.861402717154987"))
      # push!(class2, ("0.003573909385950", "0.010547719294141", "0.059696109149007", "0.929756171556853"))
      # push!(class2, ("0.004839033540485", "0.006314115948605", "0.377843269594854", "0.615842614456541"))
      # push!(class2, ("0.008471091054441", "0.013973893962392", "0.249419362774742", "0.736606743262866"))
      # push!(class2, ("0.010112684927462", "0.026686063258714", "0.137726978828923", "0.835586957912363"))
      # push!(class2, ("0.018354914106280", "0.075549132909764", "0.212775724802802", "0.711675142287434"))
      # push!(class2, ("0.016465839189576", "0.048741583664839", "0.344855770229001", "0.606402646106160"))
      # push!(class2, ("0.025804906534650", "0.134316520547348", "0.306635479062357", "0.559048000390295"))

      # 79
      push!(class0, ("0.02782022140290623181578339412694902576",))
      push!(class1, ("0.00159768158213323972394729236653288853", "0.97804771794320447192070397628224037507", "0.01097614102839776403964801185887981246"))
      push!(class1, ("0.00432255082133115505234636107890338725", "0.92537823880223061201299256742556755611", "0.03731088059888469399350371628721622194"))
      push!(class1, ("0.01420365060681688098384023296223964519", "0.04750877691900197357929625553481808806", "0.47624561154049901321035187223259095596"))
      push!(class1, ("0.01566046155214906684220350182444710172", "0.78123280657657080596625505020033275589", "0.10938359671171459701687247489983362205"))
      push!(class1, ("0.01834692594850582895962642705906902176", "0.62741000451091811445653498388475129105", "0.18629499774454094277173250805762435447"))
      push!(class1, ("0.01890479986646489537365708132039979836", "0.10889788608815036962555544313157118467", "0.44555105695592481518722227843421440766"))
      push!(class1, ("0.02757610125814091802677544543163869653", "0.21314930436580028264207251299344481704", "0.39342534781709985867896374350327759147"))
      push!(class1, ("0.02816640261504049506432089206236534967", "0.49084146465332177523029470374523072315", "0.25457926767333911238485264812738463842"))
      push!(class2, ("0.00225973920425173105896175752919647802", "0.00485493760762375328836515157891377674", "0.06409058560843406004986566761783018771", "0.93105447678394218666176918080325603554"))
      push!(class2, ("0.00440579483711699512806563540789269232", "0.00757078050469652826323345852856154599", "0.15913370765706722456461535142835185780", "0.83329551183823624717215119004308659619"))
      push!(class2, ("0.00715640047691537072986267321558586833", "0.01073721285601108733052456100789577709", "0.28058141142366523483748653054406320676", "0.70868137572032367783198890844804101614"))
      push!(class2, ("0.00739136300051059595643843722638519084", "0.00983154829280256057851123572868674209", "0.42002375881622407964644291694726894360", "0.57014469289097335977504584732404431430"))
      push!(class2, ("0.00829142305522771542552472531781523829", "0.03836368477537459537261135244715150134", "0.09995229628813865538290782334711619809", "0.86168401893648674924448082420573230055"))
      push!(class2, ("0.01197279715790938004029262807249958274", "0.04656036490766431651376955460526805646", "0.19851813222878817838002170300784899838", "0.75492150286354750510620874238688294514"))
      push!(class2, ("0.01544521564419845968874082532542670859", "0.10622720472027004236255430205389244806", "0.21560705739009440302944796795049158632", "0.67816573788963555460799772999561596561"))
      push!(class2, ("0.01733445113443866612436531302901786711", "0.05498747914298681063422724851581477104", "0.33313481730958748942762509766254251380", "0.61187770354742569993814765382164271515"))
      push!(class2, ("0.02338349146365547386509215546889092490", "0.13980807199179989859415148396841718346", "0.31786012383577201597596767163025964821", "0.54233180417242808542988084440132316831"))
    else
      @notreachable
    end

    n = 1 * length(class0) + 3 * length(class1) + 6 * length(class2)
    ω = Vector{T}(undef, n)
    ξ = Matrix{T}(undef, 3, n)

    C = BigFloat(1) / BigFloat(3)

    i = 1
    for (w̄,) in class0
      w = BigFloat(w̄)
      ω[i] = w
      ξ[1, i], ξ[2, i], ξ[3, i] = C, C, C
      i += 1
    end

    for (w̄, s̄, t̄) in class1
      w, s, t = BigFloat(w̄), BigFloat(s̄), BigFloat(t̄)
      ω[i] = w
      ξ[1, i], ξ[2, i], ξ[3, i] = s, t, t
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i], ξ[3, i] = t, s, t
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i], ξ[3, i] = t, t, s
      i += 1
    end

    for (w̄, s̄, t̄, ū) in class2
      w, s, t, u = BigFloat(w̄), BigFloat(s̄), BigFloat(t̄), BigFloat(ū)
      ω[i] = w
      ξ[1, i], ξ[2, i], ξ[3, i] = s, t, u
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i], ξ[3, i] = s, u, t
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i], ξ[3, i] = t, s, u
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i], ξ[3, i] = t, u, s
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i], ξ[3, i] = u, s, t
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i], ξ[3, i] = u, t, s
      i += 1
    end
  else
    # Default to Duffy transform from triangle to square
    # [(order + 1) // 2]^2 points
    n = o2n(order)
    x, w = gausslegendre(n)
    # Normalisation: must sum to one
    w ./= 2
    ω = Vector{T}(undef, n^2)
    ξ = Matrix{T}(undef, 3, n^2)
    c = 1
    for i in 1:n, j in 1:n
      ω[c] = w[i] * w[j] * abs(1 - x[j])
      ξ[1, c] = (1 - x[j]) * (1 + x[i]) / 4
      ξ[2, c] = (1 + x[j]) / 2
      ξ[3, c] = 1 - ξ[1, c] - ξ[2, c]
      c += 1
    end
  end

  ReferenceQuadrature{Triangle,T,order,length(ω)}(ω, ξ)
end

##############
# Quadrangle #
##############
# Economical symmetrical quadrature rules for complete polynomials over a square domain
# D. A. Dunavant
# https://doi.org/10.1002/nme.1620211004

# On the identification of symmetric quadrature rules for finite element methods
# F. D. Witherden, P. E. Vincent
# https://doi.org/10.1016/j.camwa.2015.03.017
function ReferenceQuadrature(::Type{<:Quadrangle{T}}, order::Int) where {T}
  if order <= 21
    # Identity (center), order 1
    # w, (0", "0)
    class0 = Vector{Tuple{String}}()
    # Rotation (on diagonals), order 4
    # w, (s", "0), (0, s), (-s", "0), (0, -s)
    class1 = Vector{Tuple{String,String}}()
    # Rotation (on axes), order 4
    # w, (s, s), (-s, s), (s, -s), (-s, -s)
    class2 = Vector{Tuple{String,String}}()
    # Rotation and reflexion (between axes and diagonals), order 8
    # w, (s, t), (-s, t), (s, -t), (-s, -t)
    #    (t, s), (-t, s), (t, -s), (-t, -s)
    class3 = Vector{Tuple{String,String,String}}()

    if order <= 1
      # 1
      push!(class0, ("4.00000000000000000000000000000000000000",))
    elseif order <= 3
      # 4
      push!(class2, ("1.00000000000000000000000000000000000000", "0.57735026918962576450914878050195745565"))
    elseif order <= 5
      # 8
      push!(class1, ("0.81632653061224489795918367346938775510", "0.68313005106397322554806924536807013272"))
      push!(class2, ("0.18367346938775510204081632653061224490", "0.88191710368819686350053858454642014190"))
    elseif order <= 7
      # 12
      # push!(class1, ("0.241975308641975", "0.925820099772551"))
      # push!(class2, ("0.237431774690630", "0.805979782918599"))
      # push!(class2, ("0.520592916667394", "0.380554433208316"))

      # 12
      push!(class1, ("0.24197530864197530864197530864197530864", "0.92582009977255146156656677658399952253"))
      push!(class2, ("0.23743177469063023421810525931129352533", "0.80597978291859874370785618135074424630"))
      push!(class2, ("0.52059291666739445713991943204673116603", "0.38055443320831565637910635908639413550"))
    elseif order <= 9
      # 20
      # push!(class1, ("0.018475842507491", "1.121225763866564"))
      # push!(class1, ("0.390052939160735", "0.451773049920657"))
      # push!(class2, ("0.083095178026482", "0.891849420851512"))
      # push!(class3, ("0.254188020152646", "0.411623426336542", "0.824396370149276"))

      # 20
      push!(class1, ("0.45416396068674902744178724560528503088", "0.48892685697436906957409306022929339497"))
      push!(class2, ("0.04273123186577576258013072153984165176", "0.93965525809683770585757175046316803289"))
      push!(class2, ("0.21420036092686163194242563430597811641", "0.69088055048634387281488830813840885584"))
      push!(class3, ("0.14445222326030678901782819927444760048", "0.34487202536440357617123041812469730370", "0.91862044105672225965547017914277941630"))
    elseif order <= 11
      # 25
      # push!(class0, ("0.365379525585903",))
      # push!(class1, ("0.027756165564204", "1.044402915409813"))
      # push!(class1, ("0.244272057751754", "0.769799068396649"))
      # push!(class2, ("0.034265103851229", "0.935787012440540"))
      # push!(class2, ("0.308993036133713", "0.413491953449114"))
      # push!(class3, ("0.146684377651312", "0.575653595840465", "0.883025508525690"))

      # 28
      push!(class1, ("0.21740043986871200551566672515052291339", "0.71461782966460591762942382404176367266"))
      push!(class2, ("0.21393363787824810450280500660206134837", "0.63660393221230104405852833198974404207"))
      push!(class2, ("0.27727410298385108795028691796804462632", "0.27365721017145961383557026431906649027"))
      push!(class3, ("0.04407456911498309205430427115411206178", "0.81556543368963841306389865463928759233", "0.95163038878403345881049829363696371918"))
      push!(class3, ("0.10162134051961130896131640398557349419", "0.34620720004764544118747320724330043979", "0.93556787148759108135480212161830515337"))
    elseif order <= 13
      # 36
      # push!(class1, ("0.005656169693764", "1.086056158573971"))
      # push!(class1, ("0.192443867470396", "0.658208197042585"))
      # push!(class2, ("0.005166832979773", "1.001300602991729"))
      # push!(class2, ("0.200302559622138", "0.584636168775946"))
      # push!(class2, ("0.228125175912536", "0.246795612720261"))
      # push!(class3, ("0.066655770186205", "0.745052720131169", "0.929866705560780"))
      # push!(class3, ("0.117496926974491", "0.304720678579870", "0.900258815287201"))

      # 37
      push!(class0, ("0.29999334435890964324064310267149902525",))
      push!(class1, ("0.03812862534985273761935156540568446224", "0.98346133261324557127407851401210794962"))
      push!(class1, ("0.18453546896980721238582475319389847126", "0.63986141836710976174616715579576307077"))
      push!(class2, ("0.03950714064745243368926740734172959923", "0.91877848807971140189839438297320428483"))
      push!(class2, ("0.13724209671300348677866127359579016247", "0.69955421651335111029920603284399340644"))
      push!(class2, ("0.23139851940068538741918311064046319298", "0.37962850518674385579275417103548349005"))
      push!(class3, ("0.03351978005038143027938829786808012642", "0.64359737499661812031249815775600267943", "0.97506888390598351993655206803811094573"))
      push!(class3, ("0.11357512636435423536938725920919955133", "0.33353988116478310285167199804895857823", "0.86442760926706191157507267741750728791"))
    elseif order <= 15
      # 45
      # push!(class0, ("-0.001768979827207",))
      # push!(class1, ("0.012816726617512", "1.027314357719367"))
      # push!(class1, ("0.119897873101347", "0.856766776147643"))
      # push!(class1, ("0.210885452208801", "0.327332998189723"))
      # push!(class2, ("0.006392720128215", "0.967223740028505"))
      # push!(class2, ("0.104415680788580", "0.732168901749711"))
      # push!(class3, ("0.028794154400064", "0.809863684081217", "0.960457474887516"))
      # push!(class3, ("0.076169694452294", "0.455124178121179", "0.928618480068352"))
      # push!(class3, ("0.168053047203816", "0.321696694921009", "0.621974427996805"))

      # 48
      push!(class1, ("0.11493292726352536781596028932541766228", "0.79809898789700709024555173503596148462"))
      push!(class1, ("0.18168575896727184957040458577073367484", "0.30385302639845975610268178690962703058"))
      push!(class2, ("0.00593374648583922131476141978934986810", "0.97778979953990269742424689352375866785"))
      push!(class2, ("0.04123848378876581183902763961721659985", "0.88242227010688535992041188667767184542"))
      push!(class3, ("0.02327319414467321460257489193346305992", "0.69746363199096701879389045518223605960", "0.98050484372453196154002698773025555850"))
      push!(class3, ("0.05584548249231201884068116250581288100", "0.26484415587231617710014274826830856062", "0.95574251980951170852387507604700262081"))
      push!(class3, ("0.10114914347743242280761079470300175928", "0.56721357339659070317865169083903012406", "0.80871213581950356724002823901416977471"))
      push!(class3, ("0.14783672163288121847905618360636339726", "0.30465479903705254117098598695333881061", "0.57873619403580651026013939264701051891"))
    elseif order <= 17
      # 60
      # push!(class1, ("0.020614915919991", "0.989353074512600"))
      # push!(class1, ("0.128025716179910", "0.376285207157973"))
      # push!(class2, ("0.005511739534032", "0.978848279262233"))
      # push!(class2, ("0.039207712457142", "0.885794729164116"))
      # push!(class2, ("0.076396945079863", "0.171756123838348"))
      # push!(class3, ("0.021922559481864", "0.706000287798646", "0.981321179805452"))
      # push!(class3, ("0.057387752969213", "0.347386316166203", "0.936506276127495"))
      # push!(class3, ("0.060394163649685", "0.058344481776551", "0.803743962958745"))
      # push!(class3, ("0.083903279363798", "0.597972451929457", "0.799079131916863"))
      # push!(class3, ("0.141513729949972", "0.319505036634574", "0.590499273806002"))

      # 60
      push!(class1, ("0.06534782380746491285906668897353317306", "0.91749718821915320817120277758673277115"))
      push!(class1, ("0.13880437768721992480048871346267772478", "0.54504298720914838787010174782667747048"))
      push!(class2, ("0.00765563341490993684944395966679768766", "0.96920425609150873396809064886215595774"))
      push!(class2, ("0.03671590848525151246610882325296375088", "0.87132868469544327271341598059215273696"))
      push!(class2, ("0.08625569963814380454093514127118758759", "0.69438809008955075165646918724845941430"))
      push!(class2, ("0.13455627321191692494394965878086112148", "0.45768299288315551760664997201644894176"))
      push!(class2, ("0.14285641962219959571166270516073482911", "0.19255424261404688054827243228978233862"))
      push!(class3, ("0.01511981038825686189863571538364534663", "0.76124866643908275965614948240512547767", "0.98378797150154955261318330664974572171"))
      push!(class3, ("0.02078099665596304330868125079056626423", "0.30280748178886139816768835788736238796", "0.98709470704476782545682633278929030710"))
      push!(class3, ("0.05482640023729144091667599575983460490", "0.54689867041431010640112807851437665884", "0.90739435219822367070405059478846671310"))
      push!(class3, ("0.10317672478493534779017919278157584697", "0.27947776671519215001028373596083402351", "0.76208827608019827579179765943659247047"))
    elseif order <= 19
      # 72
      # push!(class1, ("0.038205406871462", "0.943962831808239"))
      # push!(class1, ("0.135368502976521", "0.536918434376013"))
      # push!(class2, ("0.005773708558664", "0.973981076394170"))
      # push!(class2, ("0.047466627685662", "0.068354569272491"))
      # push!(class2, ("0.067460759759473", "0.742995535327609"))
      # push!(class2, ("0.140899115227892", "0.285010052188916"))
      # push!(class3, ("0.006049054506376", "1.007018449383116", "0.669414798783936"))
      # push!(class3, ("0.022331162356015", "0.295830776620995", "0.978350706908227"))
      # push!(class3, ("0.024839207949609", "0.829501421477824", "0.945161453573471"))
      # push!(class3, ("0.055594877793785", "0.541983037327871", "0.901672714410389"))
      # push!(class3, ("0.078619467342982", "0.203345534163332", "0.802952004398543"))
      # push!(class3, ("0.094979169511394", "0.426572172992877", "0.634244672807882"))

      # 72
      push!(class1, ("0.03486958349188791000216241469073329114", "0.96443426925796725147589833453960979520"))
      push!(class1, ("0.09773736469282874824351835078552754305", "0.71434425957279423719800751930789820023"))
      push!(class1, ("0.13930761292248224570420924010933858068", "0.26567205212096375634521276949089468244"))
      push!(class2, ("0.00161771517791176081099274506032840349", "0.99216540589713472189744527407633022081"))
      push!(class2, ("0.01744104803435576246409842435979821408", "0.92944960279960938592453972561789815525"))
      push!(class2, ("0.04780454716279579479500483311146926753", "0.80337972946768500184569945317555062404"))
      push!(class3, ("0.00988940093474348438128840098584413175", "0.80167158471859684259236358940451923912", "0.98844653068397375168746156789890756035"))
      push!(class3, ("0.01617957761165784978965884124895398250", "0.39073420577524975124346417118562879486", "0.98789293314173530957079377090965768822"))
      push!(class3, ("0.03898055239641053477639662170386859580", "0.62003539869325639760371263809929928256", "0.92630295580712924244748529919286127317"))
      push!(class3, ("0.06498908149259604607905980076681561216", "0.26544000781129599607199705861535014970", "0.86890243415450423858119610210847838329"))
      push!(class3, ("0.08284661898340489394081347271111379050", "0.51249187721609765575479280145710018395", "0.71716792130974519606308556126612093997"))
      push!(class3, ("0.11772583284005608002278985852480623731", "0.26664031459456217566653623598727229551", "0.51027825736934335058280520856084337461"))
    elseif order <= 21
      # 88
      # push!(class1, ("0.019503841092684", "0.980883148832881"))
      # push!(class1, ("0.089012127744268", "0.678152700336576"))
      # push!(class1, ("0.114568584702749", "0.240599282275864"))
      # push!(class2, ("0.007463627359106", "0.965176994929162"))
      # push!(class2, ("0.050585943594705", "0.749698539312765"))
      # push!(class2, ("0.074613865184212", "0.568983925500818"))
      # push!(class3, ("0.001570221774472", "0.862185099566557", "1.014086498915039"))
      # push!(class3, ("0.011588562644144", "0.645588139196562", "0.983453947854968"))
      # push!(class3, ("0.023073245798171", "0.821920249234369", "0.933927707027213"))
      # push!(class3, ("0.023501091310143", "0.355832132274584", "0.971086142843168"))
      # push!(class3, ("0.042512352239126", "0.568113580166780", "0.882246882640128"))
      # push!(class3, ("0.049102258016277", "0.168914072450263", "0.877914842155496"))
      # push!(class3, ("0.067270936863160", "0.371360260002223", "0.741324453314596"))
      # push!(class3, ("0.103507336515645", "0.237333359193547", "0.469570217710647"))

      # 85
      push!(class0, ("0.13519284035614282527922840385434746149",))
      push!(class1, ("0.06625720800494438515903105902012244034", "0.83527842975586830160520893009495292054"))
      push!(class1, ("0.10679415878594038250375421488295668420", "0.47335107435822415202690901838844666219"))
      push!(class2, ("0.00822946128922000882822171172548957840", "0.96333783211562335381484352624945730322"))
      push!(class2, ("0.03060364092877565103814115570476880668", "0.86245192537965155140267607631968215083"))
      push!(class2, ("0.06151634148131656120174994400996158651", "0.70433217519540056955932591780080720749"))
      push!(class2, ("0.09679179189359521084249771112783375661", "0.49689796251934570364793617005129236026"))
      push!(class2, ("0.11988448364634046970472217835662908028", "0.25737190060722898190537552133176369190"))
      push!(class3, ("0.00752848213040164570912493993633174490", "0.83113524597590138585974389212898407353", "0.98896061138657239166243578378631145048"))
      push!(class3, ("0.01051230415825107652575674207431691411", "0.09146960092229129666844382857347188095", "0.98401714848959892866013755872564589893"))
      push!(class3, ("0.01150952044249316757826113830818846085", "0.48891625117716687937811887553934444444", "0.99045546752952415272197458895882111757"))
      push!(class3, ("0.02877560085102053176757936762694076598", "0.67503956743707526937208896355984125883", "0.93490232582401054613354438740771124115"))
      push!(class3, ("0.03712882744091381765333071895487696092", "0.27069918410166491089101469370373344757", "0.93224193592175396207500211941993080129"))
      push!(class3, ("0.05587911740412734806304785820411782729", "0.48015696631279513715726389107913072158", "0.82464737527092073827881221191700729562"))
      push!(class3, ("0.08672849951320822490393669699955292675", "0.24187818547670197670997054949192246819", "0.67414621995531773950245618191533516236"))
    end

    n = 1 * length(class0) + 4 * length(class1) + 4 * length(class2) + 8 * length(class3)
    ω = Vector{T}(undef, n)
    ξ = Matrix{T}(undef, 2, n)

    C = BigFloat(0)

    i = 1
    for (w̄,) in class0
      w = BigFloat(w̄)
      ω[i] = w
      ξ[1, i], ξ[2, i] = C, C
      i += 1
    end

    for (w̄, s̄) in class1
      w, s = BigFloat(w̄), BigFloat(s̄)
      ω[i] = w
      ξ[1, i], ξ[2, i] = s, C
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = C, s
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = -s, C
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = C, -s
      i += 1
    end

    for (w̄, s̄) in class2
      w, s = BigFloat(w̄), BigFloat(s̄)
      ω[i] = w
      ξ[1, i], ξ[2, i] = s, s
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = s, -s
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = -s, s
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = -s, -s
      i += 1
    end

    for (w̄, s̄, t̄) in class3
      w, s, t = BigFloat(w̄), BigFloat(s̄), BigFloat(t̄)
      ω[i] = w
      ξ[1, i], ξ[2, i] = s, t
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = -s, t
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = s, -t
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = -s, -t
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = t, s
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = -t, s
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = t, -s
      i += 1

      ω[i] = w
      ξ[1, i], ξ[2, i] = -t, -s
      i += 1
    end

    # Normalisation
    ω ./= 4
  else
    # Default to tensor product
    # [(order + 1) // 2]^2 points
    n = o2n(order)
    x, w = gausslegendre(n)
    # Normalisation: must sum to one
    w ./= 2
    ω = Vector{T}(undef, n^2)
    ξ = Matrix{T}(undef, 2, n^2)
    c = 1
    for i in 1:n, j in 1:n
      ω[c] = w[i] * w[j]
      ξ[1, c] = x[i]
      ξ[2, c] = x[j]
      c += 1
    end
  end

  # Prepare for refence mapping
  ξ₁, ξ₂ = view(ξ, 1, :), view(ξ, 2, :)
  n₁ = (1 .- ξ₁) .* (1 .- ξ₂) ./ 4
  n₂ = (1 .+ ξ₁) .* (1 .- ξ₂) ./ 4
  n₃ = (1 .+ ξ₁) .* (1 .+ ξ₂) ./ 4
  n₄ = (1 .- ξ₁) .* (1 .+ ξ₂) ./ 4
  ξ = vcat(n₁', n₂', n₃', n₄')

  ReferenceQuadrature{Quadrangle,T,order,length(ω)}(ω, ξ)
end

#############
# transport #
#############
function transport(::ReferenceQuadrature, ::AbstractPolytope)
  @notimplemented
end

function transport(rq::ReferenceQuadrature{Point}, element::Point)
  ω, ξ = rq.weights, rq.points
  m = measure(element)
  p = getVertex(element, 1)
  ξ₁ = view(ξ, 1, :)

  weights = m .* ω
  points = ξ₁' .* p
  weights, points
end

function transport(rq::ReferenceQuadrature{Segment}, element::Segment)
  ω, ξ = rq.weights, rq.points
  m = measure(element)
  p₋, p₊ = getVertex(element, 1), getVertex(element, 2)
  p̄, Δp = (p₊ .+ p₋) ./ 2, (p₊ .- p₋) ./ 2
  ξ₁ = view(ξ, 1, :)

  weights = m .* ω
  points = p̄ .+ ξ₁' .* Δp
  weights, points
end

function transport(rq::ReferenceQuadrature{Triangle}, element::Triangle)
  ω, ξ = rq.weights, rq.points
  m = measure(element)
  p₁, p₂, p₃ = getVertex(element, 1), getVertex(element, 2), getVertex(element, 3)
  ξ₁, ξ₂, ξ₃ = view(ξ, 1, :), view(ξ, 2, :), view(ξ, 3, :)

  weights = m .* ω
  points = ξ₁' .* p₁ .+ ξ₂' .* p₂ .+ ξ₃' .* p₃
  weights, points
end


function transport(rq::ReferenceQuadrature{Quadrangle}, element::Quadrangle{T}) where {T}
  ω, ξ = rq.weights, rq.points
  p₁, p₂, p₃, p₄ = getVertex(element, 1), getVertex(element, 2), getVertex(element, 3), getVertex(element, 4)
  ξ₁, ξ₂, ξ₃, ξ₄ = view(ξ, 1, :), view(ξ, 2, :), view(ξ, 3, :), view(ξ, 4, :)

  # Simplify expression of the areas of the four triangles
  # a = p₂ - p₁, b = p₃ - p₂, c = p₄ - p₃, d = p₁ - p₄
  u, v = getBasis(element)
  au, av = dot₋(p₂, p₁, u), dot₋(p₂, p₁, v)
  bu, bv = dot₋(p₃, p₂, u), dot₋(p₃, p₂, v)
  cu, cv = dot₋(p₄, p₃, u), dot₋(p₄, p₃, v)
  du, dv = dot₋(p₁, p₄, u), dot₋(p₁, p₄, v)

  # Should divide by two
  m₁ = abs(det2(du, dv, au, av))
  m₂ = abs(det2(au, av, bu, bv))
  m₃ = abs(det2(bu, bv, cu, cv))
  m₄ = abs(det2(cu, cv, du, dv))

  # But should multiply by two
  weights = (m₁ .* ξ₁ .+ m₂ .* ξ₂ .+ m₃ .* ξ₃ .+ m₄ .* ξ₄) .* ω
  points = ξ₁' .* p₁ .+ ξ₂' .* p₂ .+ ξ₃' .* p₃ .+ ξ₄' .* p₄
  weights, points
end
